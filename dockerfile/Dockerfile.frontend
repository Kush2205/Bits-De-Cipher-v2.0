FROM oven/bun
WORKDIR /app

# Vite only exposes env vars prefixed with VITE_. These must be set at *build time*.
ARG VITE_API_URL
ENV VITE_API_URL=$VITE_API_URL

COPY ./package.json ./package.json
COPY ./bun.lock ./bun.lock
COPY ./packages  ./packages
COPY ./apps/frontend ./apps/frontend
RUN bun install
RUN bun run --cwd apps/frontend build
EXPOSE 4173
CMD ["bun", "run", "--cwd", "apps/frontend", "preview", "--host", "0.0.0.0", "--port", "4173"]
